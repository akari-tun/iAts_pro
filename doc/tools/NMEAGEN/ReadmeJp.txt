
                             NMEA Generator Utility

                               NMEAGEN.exe Ver2.02

                               Nov. 2016 (C)4river
                      http://4river.a.la9.jp/gps/indexj.htm

概要

  NMEA Generator は GPS受信機のNMEAセンテンスを生成してシリアルポートに出力します。
  出力周期、出力センテンス、コースなどを任意に設定できるので、GPS対応の電子地図に必要なセンテンスや
  応答速度などの動作確認に利用できます。
  外国の旅行先で使用する電子地図の動作確認を国内で行うことも出来ます。

  動作環境
    動作確認済OS:      Window 10(Desktop), Window 8(Desktop), Windows 7, Window Vista, Windows XP。
    RS-232Cボーレート: 300 ～ 460,800bps。


特徴

  1) GGA,RMC,GSA,GSV,GLL,VTG,ZDA,GNS,HDTの各センテンスを任意の周期で出力できる。
  2) コースは50地点以上の位置と標高、速度を指定できる（設定ファイルで拡張可能）。
  3) 緯度経度の分未満の桁数を指定できる。
  4) UTC時刻の秒未満の出力の有無を指定できる。
  5) NMEA0183 Ver2.3以降のMode indicatorの出力の有無を指定できる。
  6) ジオイド高を任意に設定できる。
  7) GGA,GNSとRMCの送出順序を指定できる。
  8) GGA(GNS)のFix qualityを任意に設定できる。
  9) GSA,GSVセンテンスはあらかじめ４種類を登録しておき実行時に切り換えできる。
 10) コース設定以外のオプションは実行時にリアルタイムで変更可能。
 11) オプション設定は設定ファイル NMEAGEN.ini に保存され、再起動時に反映される。
 12) 設定ファイルをリネームして数種類用意しておき、コマンドライン・オプションまたはドラッグ＆ドロップ
     で設定を瞬時に切り換えることが出来ます。


インストール
  インストールは実行ファイル NMEAGEN.exe を適当なフォルダにコピーするだけです。
  レジストリは使用しないので NMEAGEN.exeと NMEAGEN.ini の削除でアンインストールできます。


電子地図との接続

  電子地図とNMEAGEN.exeを接続するには下記の方法を用います。
  １）パソコンにシリアルポートが２個ある場合
      シリアルポート間をRS-232Cクロスケーブルで接続することにより１台のPCで利用できます。
  ２）パソコンにシリアルポートが１個しか無い場合
      ２台のパソコンを使用してパソコン間のシリアルポートをRS-232Cクロスケーブルで接続します。
  ３）パソコンにシリアルポートが無い、または１個しか無い場合
      GpsGateなどの仮想シリアルポートソフトを利用して接続します。


使用方法

  注）プルダウン・リストに無い数値はキーボードから直接入力出来ます。

 1.NMEA出力
   Start:   クリックするとNMEAセンテンスの出力を開始します。

   Idling： スタート後にクリックすると現在の位置に固定して繰り返しNMEAセンテンスを出力します。
            Startをクリックすると現在の位置から続行します。
            アイドリング中に「Jump」ボタンをクリックすることにより、セットされた地点にジャンプし
            「Start」ボタンでその地点から移動します。

   Stop:    NMEAセンテンスの出力を停止します。

   速度(Km/h): クリックする度に速度の単位が Km/h → mph → knot の順番で変更されます。
               標高とジオイド高の単位も同時に m → feet → feet に変化します。

   Monitor:    クリックするとNMEAセンテンスをモニタすることが出来ます（トグル）。

   「Sending: xxx bytes」の表示が黄色になった場合は、通信速度が不足しているので、ボーレートを上げるか
   出力周期を遅くする必要があります。

   ポイント表示
     現在のスパン－現在のポイント／現在のスパン中の総ポイント数 の形式で表示します。

 2.コース設定
   各ポイントの緯度、経度、標高、速度を入力します。
   緯度経度は下記の各種書式で指定できます。
   北緯 35°40' 49.448" の場合
     1) 35°40' 49.448" または 35°40' 49.448"N または N35°40' 49.448"
     2) 35 40 49.448 または 35 40 49.448N または N35 40 49.448
     3) 35.68040222 または 35.68040222N または N35.68040222
        で指定できます。
   南緯、西経の場合は 負号または "S", "W" を付加します。
     例）-35 40  49.448 または 35.68040222S または S35.68040222

   最後のデータに速度を指定した場合は、その速度で始点まで戻ります。
     注）速度ゼロは指定できません（データの終わりとみなします）。

   「Rep.」チェックボックスをチェックするとNMEAデータを繰り返して出力します（リピート出力）。

   停止時に「Jump」ボタンをクリックするとその位置に相当するNMEAセンテンスを単発で出力します。
   アイドリング中に「Jump」ボタンをクリックするとその位置に相当するNMEAセンテンスを連続で出力します。
   電子地図と接続して設定データの確認に利用できます。

 3.GSA,GSV
   あらかじめ設定した４種類のセンテンスを選択切り換えできます。
   「Edit」をクリックするとセンテンス・テキストが表示されるので修正することが出来ます。
   チェックサムは自動的に付加されます。
   テキストを閉じると修正した内容が適用されます。
   GGAセンテンスのHDOPと使用衛星数はGSAセンテンスから抽出します。
     注)GSA,GSV以外の任意の固定センテンスを記述して送出することも可能です。

 4.出力条件
   出力周期：    インターバルが１の時の出力周期をHzで指定します。
   NMEA:         NMEAのバージョンを指定します。
                   2.3 : GNSセンテンス、MODE をサポート。
                   4.1 : GNSセンテンス、MODE、Navigation Status をサポート。
   Nav. Status:  Navigation Status を設定します。
   GGA,RMC,GLL,VTG,ZDA,GNS,HDT,GSA,GSV:
                「出力」チェックボックスでセンテンスを出力するかどうかを指定します。
                「インターバル」で出力周期の何カウント毎に出力するかを指定します。
                「プリフィックス」でセンテンスの先頭２文字を指定します。
   緯度経度小数：緯度経度の分以下の小数部分の桁数を指定します（1～8）。
   秒少数：      時刻の秒未満の桁数を指定します（0～3）。
   ジオイド高：  ジオイド高を指定します。
   GGA品質：     GGAセンテンスの品質ステイタスを指定します。

               設定値と各センテンス・ステイタスへの割り当て。
                                       GGA   RMC  RMC,GNS
                     設定値          Status Status Mode
                 Invalid                0     V     N    測位不可
                 GPS fix (SPS)          1     A     A    測位中
                 DGPS fix               2     A     D    DGPS測位中
                 PPS fix                3     A     P    PPS測位中
                 Real Time Kinematic    4     A     R    RTK測位中
                 Float RTK              5     A     F    フロートRTK測位中
                 Estimated              6     V     E    推測航法
                 Manual input mode      7     V     M    手動入力
                 Simulation mode        8     V     S    模擬モード

               RMC Status
                 V: 無効
                 A: 有効

   RMC先行:    チェックするとRMCセンテンスを先に出力します。

 5.シリアルポート
   ポート番号： シリアルポートの番号を指定します。
   速度(bps)：  通信速度を指定します。
   Open：       クリックするとシリアルポートをオープンします。
   Close：      クリックするとシリアルポートをクローズします。

   ポート番号や速度を変更する場合は一旦ポートをクローズして行います。

   Exit:  NMEAGEN.exeを終了します。

 6.コマンド・ラインオプション
   設定ファイルを指定しておくことにより任意のオプションファイルを適用できます。
   設定ファイルの拡張子は .ini に限定されます。
     例）NMEAGEN tokyo.ini

   パスまたはファイル名に空白を含む場合は二重引用符「"」で囲む必要があります。
     例）NMEAGEN "C:\Documents and Settings\User\tokyo.ini"

 7.ドラッグ＆ドロップ
   設定ファイルを実行ファイル・アイコンまたはフォームにドラッグすることにより、任意の設定条件を瞬時に適用できます。
   但し、NMEAセンテンスの出力中はドラッグ＆ドロップを無視します。

 8.設定ファイル(NMEAGEN.ini)
   設定ファイルの有るフォルダが書込み禁止の場合はフォルダ %APPDATA%\NMEAGEN\ にコピーして使用します。
   %APPDATA% はDOSプロンプトで echo %APPDATA% と入力すると表示されるフォルダです。

  1) [Output]セクション
     NMEAセンテンスの出力条件を保存しています。

  2) [Track]セクション
     コースデータを保存しています。
       書式： Dn=緯度, 経度, 標高, 速度

  3) [Serial]セクション
     シリアルポート番号と通信速度を保存しています。

  4) [Option]セクション
     フォント、速度の単位、表示位置を保存しています。
     フォント指定はメインフォームにのみ有効です。

     日本語以外のフォント指定の初期値。
       EngCharset=0
       EngFontName=Arial
       EngFontSize=8

     日本語フォントの初期値。
       JpCharset=1
       JpFontName=Tahoma
       JpFontSize=8

     コースの最大数は TrackMax で指定します。
       例）TrackMax=50

     ZDAセンテンスの時差の時間と分は TimeDiff で指定します。
       例）TimeDiff=-9:0

     RMCセンテンスの磁気偏角は MagVari で指定します（VTGセンテンスにも適用する）。
       例）MagVari=-7.0

  5) [DGPS]セクション
     GGAセンテンスの DGPS経過 と DGPS-ID の初期値。
       Invalid=,
       SPS=,
       DGPS=30,0137
       PPS=,
       RTK=,
       FloatRTK=,
       Estimated=,
       Manual=,
       Simulation=,

  6) [GSAGSV]セクション
     GSA,GSVセンテンスの指定。


 9.トラブルシュート

  1)電子地図のGPS接続時にエラーが発生する。
    電子地図によってはシリアルポート接続時に無信号だと異常終了します。
    「Idling」ボタンをクリックしてからGPSの接続操作を行ってください。

  2)「Start」でのトレースと「Jump」でのトレースが異なる。
    平面に投影された地図上で直線を描画しているためです。
    球体上の描画を平面に投影する地図ではトレースが一致します。

  3)「Sending: xxx bytes」が黄色でも遅延を生じない。
    GSA、GSVセンテンスのインターバルが２以上の場合は、GSA、GSVが休止している期間に遅延が解消される場合があります。
    仮想シリアルポートの場合は通信速度に関係なくデータを転送するため遅延は生じません。


制限事項および注意事項

  １）区間の始点と終点を合わせるため速度を微調整します。
  ２）区間の中間地点は直交座標上で比例配分するため、広域の場合や高緯度の場合は誤差が大きくなります。
  ３）中間地点は等分配置しており、始動停止時の加速度制御は行いません。
  ４）GSA,GSVセンテンスはプリセットデータを使用するため自動的には変化しません。
  ５）出力周期に応じた伝送速度が必要です。
     「Sending: xxx byts」の表示が黄色の場合は、伝送速度が不足でデータ遅延の可能性があります。
  ６）電子地図のレスポンスは使用するパソコンの能力に依存します。


使用コンパイラおよびコンポーネント

    コンパイラには Delphi 10.1 Berlin を使用しています。

    またフリー・コンポーネント
    CommX Ver1.06  エックス (KYY06770)氏作 ＲＳ２３２Ｃ通信コンポーネント COMMX106.LZH を使用しています。
    非常に有用なコンポーネントを提供された作者の方に感謝いたします。


・このアプリケーションはフリーソフトウェアです。
・再配布は自由ですが実行ファイルとドキュメントを含めて配布願います。
・作者はこのアプリケーションの使用または配布によって生じた、いかなる損失及び障害に対しても一切の責任を負いません。


変更履歴

  Ver2.02
    1. 「出力周期」と「ジオイド高」コンボボックスのDropDownCount値を大きくした。

  Ver2.01
    1. NMEA 4.1のNavigation Status出力をサポートした (RMC, GNS)。
    2. 設定ファイルの文字コードをUNICODEに変更した（既存の設定ファイルは変更しない）。
    3. コンパイラを Delphi 10.1 Berlin に変更した。

  Ver2.00 Jul. 2016
    1. NMEAセンテンスのプリフィックスを選択できるようにした。
    2. HDTセンテンスの出力を可能にした。
    3. 設定ファイルのTypoを修正した。
    4. コンパイラを Delphi XE8 に変更した。

  Ver1.18 Aug. 2013
    1. NMEAセンテンス時刻の秒未満の桁数を指定できるようにした。

  Ver1.17 Aug. 2013
    1. オプションのフォントを「GSA,GSV」と「NMEA sentence」フォームに適用されるように修正した。
    2. 各Labelの上下方向の位置を中央に設定した。

  Ver1.16 Jul. 2013
    1. ディスプレイのDPIを変更した場合にレイアウトが崩れないようにした（フォントサイズの調整は必要）。

  Ver1.15 May. 2013
    1. ジオイド高の変更がリアルタイムに出力されるようにした。

  Ver1.14 Apr. 2013
    1. チェックサム付きのGSA,GSV センテンスが与えられた場合にはチェックサムを付加しないようにした。

  Ver1.13 Apr, 2013
    1. GPVTGセンテンスの針路/磁北の偏移方向の誤りを修正した。

  Ver1.12 Mar. 2013
    1. GLL, VTG, ZDA センテンス出力を追加した。
    2. RMCセンテンスの磁気偏角を設定ファイルで指定できるようにした（VTGセンテンスにも適用する）。
    3. ZDAセンテンスの時差の時分を設定ファイルで指定できるようにした。
    4. UTC秒未満の出力をデフォルトでOFFに変更した。

  Ver1.11 Mar. 2013
    1. 最大トラック数を設定ファイルで指定できるようにした（デフォルトは５０）。
       ストリンググリッドにスクロールバーを追加した。
    2. 設定ファイルの整理
       [Option]セクションからDGPSステイタスを[DGPS]セクションにを分離した。
       [Data]セクションを[GSAGSV]と[Track]に分離した。
       トラック情報を１ポイント当たり１行にまとめた。

  Ver1.10 Feb. 2013
    1. GNGNSセンテンスを追加した。
    2. GSA を２種類、GSVを10種類出力可能にした。
    3. $GPGGA,$GPRMCの代わりに$GNGGA,%GNRMCを出力できるようにした。
    4. コースポイントを６ポイントに増加した。
    5. プログレスバーを追加した。

  Ver1.09 Dec. 2012
    1. GGAセンテンスの DGPS経過 と DGPS-ID を設定できるようにした。
       設定ファイル NMEAGEN.ini の [Option] セクションで設定できる。

  Ver1.08 Jan. 2008
    1. 設定ファイルが書込み禁止フォルダに有る場合の対策を追加した。
    2. キロの表示を小文字に直した。

  Ver1.07 Oct. 2007
    1. 距離の計算を精密に行うようにした。
    2. アイドリング時の「Jump」ボタンクリックで余分なNMEAを送出しないようにした。

  Ver1.06 Oct. 2007
    1. アイドリング時の針路/真北=0を廃止した。
    2. マニュアル追補。

  Ver1.05 Oct. 2007
    1. 最後のコースデータに速度を記入した場合は始点まで戻るようにした。
    2. 距離レポートの小数点以下の桁数を値によって調整するようにした。
    3. リピート出力機能を追加した。
    4. アイドリング中のJumpを可能にした。

  Ver1.04 Sep. 2007
    1. 距離と所要時間の表示を追加した（現スパン／総計)
    2. スパン分割数の誤りを修正した。

  Ver1.03 Sep. 2007
    1. 設定ファイルのドラッグ＆ドラッグでポート番号、ボーレート、表示位置がブランクの場合は
       元の設定をを引き継ぐようにした。
    2. その他、細部の修正を行った。

  Ver1.02 Sep. 2007
    1. 設定ファイルでフォントを指定できるようにした。
    2. シリアルポートのオープン後に有効ポートを再取得するようにした。
    3. RMCモードを設定ファイルに保存してなかったのを修正した。
    4. 緯度の整数部の桁数を４桁に、経度の整数部の桁数を５桁に固定した。

  Ver1.01 Sep. 2007
    1. RMCセンテンスの「針路/真北」の計算を各ポイント毎に再計算するようにした。

  Ver1.00 Sep. 2007 初版リリース
